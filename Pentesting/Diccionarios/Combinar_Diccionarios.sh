#!/bin/bash
#Script realizado por Raúl Caro Pastoriono (fryntiz) fryntiz@gmail.com
#GitHub --> https://github.com/fryntiz

#Variables Generales
espacio=""
eliminar_ceros=false
escribir_salida=false

##### CONSTANTES COLORES #####
rojo="\033[0;31m"
verde="\033[0;32m"
azul="\033[0;34m"
magenta="\033[0;35m"
cyan="\033[01;36m"
grisC="\033[0;37m"
gris="\033[1;30m"
rojoC="\033[1;31m"
verdeC="\033[1;32m"
amarillo="\033[1;33m"
azulC="\033[1;34m"
magentaC="\033[1;35m"
cyanC="\033[1;36m"
blanco="\033[1;37m"

clear

mensaje() {
	echo -e "  $rojoC Modo de uso:"
	echo -e " $amarillo$0 [OPCIONES] <Diccionario1> <Diccionario2>"
	echo ""
	echo -e "   $azulC Opciones:"
	echo -e "   $verdeC -e, Insertar espacio entre cada palabra"
	echo -e "   $cyanC -h, Mostrar esta ayuda"
	echo -e "   $verdeC -z, Omitir ceros en los diccionarios"
	echo -e "   $cyanC -o, Especificar archivo de salida."
	echo ""
	echo ""
	echo -e "$amarillo Este script combinará todas las posibilidades del$rojoC Diccionario1$amarillo con el$rojoC Diccionario2$amarillo detrás."
	echo -e " Para hacerlo al revés simplemente cambia el orden de los diccionarios al ejecutar el script$blanco"
	echo ""
}

if [ $# -eq 0 ] #Comprueba que existen parámentros
	then
		mensaje
		exit 1
fi

while getopts "zeho:" Opcion
	do
		case $Opcion in
			e)
				espacio=" "
				;;
			h)
				echo "Menu de ayuda"
				echo ""
				mensaje
				exit 1
				;;
			z)
				eliminar_ceros=true
				;;
			o)
				salida=$OPTARG
				escribir_salida=true
				;;
			?)
				echo "opción $OPTARG no reconocida"
				;;
			:)
				echo "opción $OPTARG requiere un argumento"
				;;
		esac
	done

shift $(( OPTIND -1 ))

if [ -z $1 ]||[ -z $2 ]
	then
		echo "Faltan argumentos válidos"
		exit 1
fi

if [ ! -e $1 ]
	then
		echo "No se ha podido encontrar $1"
		exit 1
fi

if [ ! -e $2 ]
	then
		echo "No se ha podido encontrar $2"
		exit 1
fi

for f1 in $(if [ $eliminar_ceros == true ]
	then
		cat $1|tr -d "0" #elimina el caracter "0"
	else
		cat $1 |tr -d "\r"
	fi)

do
	for f2 in $(if [ $eliminar_ceros == true ]
		then
			cat $2|tr -d "0"
		else
			cat $2 |tr -d "\r"
		fi)

	do
		if [ $escribir_salida == true ]
			then
				echo $f1$espacio$f2 >> /tmp/Desordenado-$salida #Escribir salida en archivo omitiendo "intro"
				echo $f1$espacio$f2
			else
				echo $f1$espacio$f2 |tr -d "\r" #Mostrar salida sin escribirla omitiendo "intro"
		fi
	done
done

if [ /tmp/Desordenado-$salida ]
	then
		#sort /tmp/Desordenado-$salida > $salida
		cat /tmp/Desordenado-$salida | sort | uniq >$salida
		if [ $salida ]
			then
				sleep 5
				rm /tmp/Desordenado-$salida
			else
				echo -e "$rojoC Ha ocurrido algún problema"
				echo -e " El diccionario no ha podido crearse correctamente"
				echo -e " Comprueba el archivo /tmp/Desordenado-$salida"
				echo -e " Este archivo contendrá el diccionario sin ordenar ni filtrar"
				echo -e " Puedes ponerte en contacto con el creador del script si no consigues solucionar el problema$blanco"
		fi
fi
#Script realizado por Raúl Caro Pastoriono (fryntiz)
